{% extends 'dashboard/adviser.base.html' %}
{% load static %}
{% block title %}
    Dash-Asesor
{% endblock %}

{% block title_section %}
    Centro de Control
{% endblock %}

{% block content_seccion %}
    <div class="table-responsive">
        <ul class="list-group">
            {% for order in orders %}
            <li class="list-group-item mb-2 shadow" order_id="{{ order.store_order_id }}" >
                <div class='row'>
                    <!-- Aqui comienza cada item -->
                    <div class='col-2'>
                        <div>
                            <div class="row">
                                <span class="text-black">Estado Actual:</span> 
                            </div>
                            <div class="row">
                                <p>{{ order.get_state_display }}</p> 
                            </div>
                        </div>
                        <div class="row">
                            <span class="text-black">Pasar a:</span> 
                        </div>
                        <div class="row mb-1">
                            <div id='{{ order.store_order_id }}'
                                class='btn btn-primary mb-1 ml-0 col-9'
                                data-toggle="modal"
                                data-target="#stateModal"
                                state='{{ order.state }}'
                            >{{ order.next_state }}</div>
                            <div id='{{ order.store_order_id }}'
                                class='btn btn-secondary ml-0 col-9'
                                data-toggle="modal"
                                data-target="#cancelOrderModal"
                            >Cancelar</div>
                        </div>
                    </div>
                    <div class='col-7'>
                        <h5>{{ order.product.title }}</h5>
                        <div class="d-flex">
                            <div class='flex-fill'>
                                <img
                                    class="rounded"
                                    src="{{ order.product.image }}"
                                    alt="{{ order.product.title }}"
                                >
                            </div>
                            <div class="flex-grow-1">
                                <div class="row">
                                    <span class="text-black">Numero de Pedido:</span>
                                    <p>{{ order.store_order_id }}</p>
                                </div>
                                <div class="row">
                                    <span class="text-black">Numero de Orden:</span>
                                    <p>{{ order.provider_order_id }}</p>
                                </div>
                                <div class="row">
                                    <span class="text-black">Guia del Envio:</span>
                                    <p>{{ order.shipping.guide }}</p>
                                </div>
                                <div class="row">
                                    <span class="text-black">Publicacion del proveedor:</span>
                                    <a
                                        target="_blank"
                                        href="{{ order.product.provider_link }}"
                                    >Link</a>
                                </div>
                                <div class="row">
                                    <span class="text-black">Referencia de Pago:</span>
                                    <p>{{ order.invoice.pay.reference }}</p>
                                </div>
                            </div>
                            <div class="flex-fill">
                                <div
                                    api='show_news'
                                    class='btn btn-info ml-0 align-content-center align-items-center'
                                    order='{{ order.id }}'
                                    show-news=''
                                >Novedades</div>
                            </div>
                        </div>
                    </div>
                    <div class='col-2'>
                        <div class="row">
                            <span class="text-black">Nombre Completo:</span>
                            <p>{{ order.buyer.first_name }} {{ order.buyer.last_name }}</p>
                        </div>
                        <div class="row">
                            <span class="text-black">Telefono:</span>
                            <p>{{ order.buyer.phone }}</p>
                        </div>
                        <div class="row">
                            <span class="text-black">Direccion:</span>
                            <p>{{ order.buyer.direction }}</p>
                        </div>
                        <div class="row">
                            <span class="text-black">Precio de Venta:</span>
                            <p>{{ order.invoice.pay.amount }}</p>
                        </div>
                    </div>
                    <!-- Final de cada item -->
                </div>
            </li>
            <div id="containerNews-{{order.id}}" class="container"></div>
            {% endfor %}  
        </ul> 
    </div>
    <!-- State Modal-->
    <div class="modal fade" id="stateModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Siguiente estado de order: Pagado</h5>
                    <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">Ã—</span>
                    </button>
                </div>
                <div id='formContainer'>
                    <p>Si puedes ver esto contacta al Desarrolador, esto es un problema.</p>
                </div>
            </div>
        </div>
    </div>

    <script src="{% static 'js/dashboard/search_orders.js' %}"></script>
    <script src="{% static 'js/dashboard/next_state.js' %}"></script>
    <script src="{% static 'js/dashboard/news.js' %}"></script>
{% endblock %}
